{"ast":null,"code":"import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';\nimport { setCredentials } from '../../features/auth/authSlice';\nconst baseQuery = fetchBaseQuery({\n  baseUrl: 'http://localhost:3500',\n  // set the 'include' keyword to include token\n  credentials: 'include',\n  // prep the payload headers and destructure 'getState'\n  prepareHeaders: (headers, _ref) => {\n    let {\n      getState\n    } = _ref;\n    // set the \"AUTH state\" with the Bearer's token\n    const token = getState().auth.token;\n    if (token) {\n      headers.set('authorization', `Bearer ${token}`);\n    }\n    return headers;\n  }\n});\nconst baseQueryWithReauth = async (args, api, extraOptions) => {\n  var _result, _result$error;\n  // console.log(args) // request url, method, body\n  // console.log(api) // signal, dispatch, getState()\n  // console.log(extraOptions) // custom like {shout: ture}\n\n  let result = await baseQuery(args, api, extraOptions);\n  if (((_result = result) === null || _result === void 0 ? void 0 : (_result$error = _result.error) === null || _result$error === void 0 ? void 0 : _result$error.status) === 403) {\n    console.log('sending refresh token');\n\n    // set refresh token to get new acces token\n    const refreshResult = await baseQuery('/auth/refresh', api, extraOptions);\n    if (refreshResult !== null && refreshResult !== void 0 && refreshResult.data) {\n      //store the new token\n      api.dispatch(setCredentials({\n        ...refreshResult.data\n      }));\n      result = await baseQuery(args, api, extraOptions);\n    } else {\n      var _refreshResult$error;\n      if ((refreshResult === null || refreshResult === void 0 ? void 0 : (_refreshResult$error = refreshResult.error) === null || _refreshResult$error === void 0 ? void 0 : _refreshResult$error.status) === 403) {\n        refreshResult.error.data.message = 'Your login has expired.';\n      }\n      return refreshResult;\n    }\n  }\n};\nexport const apiSlice = createApi({\n  baseQuery,\n  tagTypes: ['Note', 'User'],\n  endpoints: builder => ({})\n});","map":{"version":3,"names":["createApi","fetchBaseQuery","setCredentials","baseQuery","baseUrl","credentials","prepareHeaders","headers","_ref","getState","token","auth","set","baseQueryWithReauth","args","api","extraOptions","_result","_result$error","result","error","status","console","log","refreshResult","data","dispatch","_refreshResult$error","message","apiSlice","tagTypes","endpoints","builder"],"sources":["/Users/scottlucas/Desktop/dave_mern_frontend/dave_mern_frontend/src/app/api/apiSlice.js"],"sourcesContent":["import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react'\nimport { setCredentials } from '../../features/auth/authSlice'\n\nconst baseQuery = fetchBaseQuery({\n  baseUrl: 'http://localhost:3500',\n  // set the 'include' keyword to include token\n  credentials: 'include',\n  // prep the payload headers and destructure 'getState'\n  prepareHeaders: (headers, { getState }) => {\n    // set the \"AUTH state\" with the Bearer's token\n    const token = getState().auth.token\n    if (token) {\n      headers.set('authorization', `Bearer ${token}`)\n    }\n    return headers\n  },\n})\n\nconst baseQueryWithReauth = async (args, api, extraOptions) => {\n  // console.log(args) // request url, method, body\n  // console.log(api) // signal, dispatch, getState()\n  // console.log(extraOptions) // custom like {shout: ture}\n\n  let result = await baseQuery(args, api, extraOptions)\n\n  if (result?.error?.status === 403) {\n    console.log('sending refresh token')\n\n    // set refresh token to get new acces token\n    const refreshResult = await baseQuery('/auth/refresh', api, extraOptions)\n\n    if (refreshResult?.data) {\n      //store the new token\n      api.dispatch(setCredentials({ ...refreshResult.data }))\n\n      result = await baseQuery(args, api, extraOptions)\n    } else {\n      if (refreshResult?.error?.status === 403) {\n        refreshResult.error.data.message = 'Your login has expired.'\n      }\n      return refreshResult\n    }\n  }\n}\n\nexport const apiSlice = createApi({\n  baseQuery,\n  tagTypes: ['Note', 'User'],\n  endpoints: builder => ({}),\n})\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,cAAc,QAAQ,8BAA8B;AACxE,SAASC,cAAc,QAAQ,+BAA+B;AAE9D,MAAMC,SAAS,GAAGF,cAAc,CAAC;EAC/BG,OAAO,EAAE,uBAAuB;EAChC;EACAC,WAAW,EAAE,SAAS;EACtB;EACAC,cAAc,EAAEA,CAACC,OAAO,EAAAC,IAAA,KAAmB;IAAA,IAAjB;MAAEC;IAAS,CAAC,GAAAD,IAAA;IACpC;IACA,MAAME,KAAK,GAAGD,QAAQ,CAAC,CAAC,CAACE,IAAI,CAACD,KAAK;IACnC,IAAIA,KAAK,EAAE;MACTH,OAAO,CAACK,GAAG,CAAC,eAAe,EAAG,UAASF,KAAM,EAAC,CAAC;IACjD;IACA,OAAOH,OAAO;EAChB;AACF,CAAC,CAAC;AAEF,MAAMM,mBAAmB,GAAG,MAAAA,CAAOC,IAAI,EAAEC,GAAG,EAAEC,YAAY,KAAK;EAAA,IAAAC,OAAA,EAAAC,aAAA;EAC7D;EACA;EACA;;EAEA,IAAIC,MAAM,GAAG,MAAMhB,SAAS,CAACW,IAAI,EAAEC,GAAG,EAAEC,YAAY,CAAC;EAErD,IAAI,EAAAC,OAAA,GAAAE,MAAM,cAAAF,OAAA,wBAAAC,aAAA,GAAND,OAAA,CAAQG,KAAK,cAAAF,aAAA,uBAAbA,aAAA,CAAeG,MAAM,MAAK,GAAG,EAAE;IACjCC,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAC;;IAEpC;IACA,MAAMC,aAAa,GAAG,MAAMrB,SAAS,CAAC,eAAe,EAAEY,GAAG,EAAEC,YAAY,CAAC;IAEzE,IAAIQ,aAAa,aAAbA,aAAa,eAAbA,aAAa,CAAEC,IAAI,EAAE;MACvB;MACAV,GAAG,CAACW,QAAQ,CAACxB,cAAc,CAAC;QAAE,GAAGsB,aAAa,CAACC;MAAK,CAAC,CAAC,CAAC;MAEvDN,MAAM,GAAG,MAAMhB,SAAS,CAACW,IAAI,EAAEC,GAAG,EAAEC,YAAY,CAAC;IACnD,CAAC,MAAM;MAAA,IAAAW,oBAAA;MACL,IAAI,CAAAH,aAAa,aAAbA,aAAa,wBAAAG,oBAAA,GAAbH,aAAa,CAAEJ,KAAK,cAAAO,oBAAA,uBAApBA,oBAAA,CAAsBN,MAAM,MAAK,GAAG,EAAE;QACxCG,aAAa,CAACJ,KAAK,CAACK,IAAI,CAACG,OAAO,GAAG,yBAAyB;MAC9D;MACA,OAAOJ,aAAa;IACtB;EACF;AACF,CAAC;AAED,OAAO,MAAMK,QAAQ,GAAG7B,SAAS,CAAC;EAChCG,SAAS;EACT2B,QAAQ,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC;EAC1BC,SAAS,EAAEC,OAAO,KAAK,CAAC,CAAC;AAC3B,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}